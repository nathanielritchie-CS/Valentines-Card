<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Be My Valentine</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg,#ffe6ef,#fff);
      overflow:hidden;
    }
    .card{
      width:min(720px,92vw);
      padding:32px;
      border-radius:24px;
      background: rgba(255,255,255,.82);
      border:1px solid rgba(0,0,0,.06);
      box-shadow: 0 20px 60px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      text-align:center;
      position:relative;
      z-index:2;
    }
    h1{
  margin:0 0 8px;
  font-size: clamp(36px, 5vw, 64px);
  font-family: 'Great Vibes', cursive;
  font-weight: 400;
  letter-spacing: 1px;
  text-shadow: 0 4px 18px rgba(255,77,125,.35);

}
    p{ margin:0 0 18px; opacity:.7; }

    .row{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:16px;
      flex-wrap: wrap;
    }

    .btn{
      border:0;
      padding:14px 22px;
      border-radius:999px;
      font-size:18px;
      font-weight:800;
      min-width:150px;
      text-align:center;
      cursor:pointer;
      box-shadow:0 14px 34px rgba(0,0,0,.10);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .yes{
      background: linear-gradient(135deg,#ff4d7d,#ff7aa2);
      color:#fff;
    }

    /* Ghost placeholder so the row centers like it has two buttons */
    .ghost{
      visibility:hidden;
      pointer-events:none;
    }

    /* No is fixed and moves anywhere */
    .no{
      position: fixed;
      left: 0;
      top: 0;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      z-index:3;
      visibility:hidden; /* hidden until placed */
    }

    .msg{ margin-top:16px; font-weight:800; color:#b31243; min-height:1.4em; }

    /* bubble attached to No */
    .speech{
      position:fixed;
      left:0; top:0;
      transform: translate(-9999px,-9999px);
      pointer-events:none;
      z-index:9999;
      opacity:0;
      transition: opacity .12s ease;
    }
    .speech.show{ opacity:1; }

    .speech .bubble{
      padding:10px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 16px 44px rgba(0,0,0,.12);
      font-weight:900;
      color:#c2184b;
      max-width: 260px;
      white-space: nowrap;
    }
    .speech .tail{
      width: 12px;
      height: 12px;
      background: rgba(255,255,255,.92);
      border-left: 1px solid rgba(0,0,0,.08);
      border-bottom: 1px solid rgba(0,0,0,.08);
      transform: rotate(45deg);
      margin-left: 18px;
      margin-top: -6px;
      border-bottom-left-radius: 4px;
    }

    /* ---------- Celebration screen ---------- */
    .celebrate{
      position:fixed;
      inset:0;
      display:none;
      z-index:50;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.65), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(255,180,205,.35), transparent 60%),
        linear-gradient(180deg,#ffe6ef,#fff);
    }
    .celebrate.show{ display:block; }

    #party{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }

    .celebrate-ui{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      text-align:center;
      pointer-events:none;
      padding:24px;
    }
    .celebrate-card{
      pointer-events:none;
      padding:22px 24px;
      border-radius:22px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 20px 60px rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
      max-width: min(680px, 92vw);
    }
    .big{
      font-size: clamp(34px, 5vw, 60px);
      margin: 0 0 6px;
      letter-spacing: .2px;
    }
    .small{
      margin:0;
      opacity:.75;
      font-weight:700;
      font-size: clamp(14px, 2vw, 18px);
    }

    /* ---------- Liv's eyes only toggle + hidden image ---------- */
    .secret-btn{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 60; /* above main page, below speech bubble */
      border: 0;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      cursor: pointer;
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 34px rgba(0,0,0,.12);
      backdrop-filter: blur(8px);
    }

    /* Your cutout image (no background) */
    .lift-img{
      position: fixed;
      left: 50%;
      bottom: -43px;
      transform: translateX(-50%);
      height: min(70vh, 720px);
      z-index: 3;              /* same layer as the No button */
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease;
    }
    .lift-img.show{
      opacity: 1;
    }
    .love-wall{
  position:absolute;
  inset:0;
  overflow:hidden;
  pointer-events:none;
  z-index: 51; /* above background, below canvas/ui (canvas is also inside celebrate) */
  mix-blend-mode: multiply;
}

.love-track{
  position:absolute;
  left:-10%;
  top:18%;
  width:120%;
  display:flex;
  gap: 48px;
  white-space: nowrap;
  opacity: .16;
  transform: rotate(-10deg);
  animation: loveSlide 18s linear infinite;
}

.love-track.alt{
  top:58%;
  opacity: .12;
  transform: rotate(8deg);
  animation-duration: 22s;
  animation-direction: reverse;
}

.love-track span{
  font-size: clamp(28px, 4.2vw, 64px);
  font-weight: 900;
  letter-spacing: 1px;
  color: rgba(255, 77, 125, .55);
  text-shadow: 0 18px 50px rgba(255,77,125,.12);
  animation: lovePulse 3.4s ease-in-out infinite;
}

.love-track.alt span{
  color: rgba(255, 122, 162, .45);
  animation-duration: 4.2s;
}

@keyframes loveSlide{
  from { transform: translateX(0) rotate(-10deg); }
  to   { transform: translateX(-40%) rotate(-10deg); }
}

@keyframes lovePulse{
  0%,100%{ transform: translateY(0) scale(1); opacity: 1; }
  50%    { transform: translateY(-6px) scale(1.02); opacity: .85; }
}
/* ---------- Floating Envelope ---------- */
.env-float{
  position: fixed;
  left: 12vw;
  top: 65vh;
  width: 110px;             /* relatively small */
  height: auto;
  padding: 0;
  border: 0;
  background: transparent;
  cursor: pointer;
  z-index: 80;              /* above canvas */
  transform: translate(-50%, -50%);
  animation: envBob 4.5s ease-in-out infinite;
  filter: drop-shadow(0 18px 30px rgba(0,0,0,.18));
  display: none;            /* hidden until celebration */
}

.env-float img{
  width: 100%;
  height: auto;
  display: block;
  user-select: none;
}

/* little "paper" that slides out of the envelope when opening */
.env-float::before{
  content:"";
  position:absolute;
  left: 10%;
  right: 10%;
  top: 14%;
  height: 64%;
  border-radius: 10px;
  background:
    linear-gradient(#fff, #fff),
    repeating-linear-gradient(
      to bottom,
      rgba(255,77,125,.20) 0px,
      rgba(255,77,125,.20) 1px,
      transparent 10px,
      transparent 18px
    );
  box-shadow: 0 14px 26px rgba(0,0,0,.12);
  transform: translateY(22px);
  opacity: 0;
  transition: transform .45s ease, opacity .2s ease;
  z-index: -1; /* behind envelope image */
}

/* when "opening" */
.env-float.open{
  animation-play-state: paused;
  transform: translate(-50%, -50%) scale(1.02);
}
.env-float.open::before{
  transform: translateY(-42px);
  opacity: 1;
}

@keyframes envBob{
  0%,100%{ transform: translate(-50%, -50%) translateY(0); }
  50%    { transform: translate(-50%, -50%) translateY(-10px); }
}

/* ---------- Letter (notepad) modal ---------- */
.letter-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.18);
  backdrop-filter: blur(3px);
  display: none;
  z-index: 120; /* above everything */
}

.letter-overlay.show{
  display: grid;
  place-items: center;
}

.letter{
  width: min(680px, 92vw);
  border-radius: 18px;
  padding: 22px 22px 20px;
  background:
    linear-gradient(#fff, #fff),
    repeating-linear-gradient(
      to bottom,
      rgba(255,77,125,.18) 0px,
      rgba(255,77,125,.18) 1px,
      transparent 12px,
      transparent 22px
    );
  box-shadow: 0 30px 90px rgba(0,0,0,.22);
  border: 1px solid rgba(0,0,0,.10);
  position: relative;
  transform: translateY(10px) scale(.98);
  opacity: 0;
  animation: letterIn .28s ease forwards;
}

@keyframes letterIn{
  to { transform: translateY(0) scale(1); opacity: 1; }
}

.letter h3{
  margin: 0 0 10px;
  font-size: 24px;
}

.letter p{
  margin: 0 0 10px;
  line-height: 1.55;
  font-weight: 650;
  color: rgba(0,0,0,.78);
}

.letter-close{
  position: absolute;
  top: 10px;
  right: 10px;
  border: 0;
  padding: 10px 12px;
  border-radius: 999px;
  cursor: pointer;
  font-weight: 900;
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(0,0,0,.10);
}

/* envelope disappears in a cute "whisp" */
.env-float.whisp{
  animation: none !important;
  transition: opacity .45s ease, transform .45s ease, filter .45s ease;
  opacity: 0;
  transform: translate(-50%, -50%) translateY(-40px) scale(.96);
  filter: blur(1px) drop-shadow(0 18px 30px rgba(0,0,0,.18));
}

  </style>
</head>
<body>
  <main class="card" id="card">
    <h1>Will you be my valentine?</h1>
    <p>Say yes or elseðŸ’—</p>
    

    <div class="row">
      <button class="btn yes" id="yesBtn">Yes ðŸ’˜</button>
      <button class="btn ghost" aria-hidden="true" tabindex="-1">No ðŸ™ˆ</button>
    </div>

    <div class="msg" id="msg"></div>
  </main>

  <button class="btn no" id="noBtn">No ðŸ™ˆ</button>

  <div class="speech" id="speech" aria-hidden="true">
    <div class="bubble" id="speechText"></div>
    <div class="tail"></div>
  </div>

  <!-- Liv's eyes only toggle -->
  <button class="secret-btn" id="secretBtn" type="button">Livâ€™s eyes only</button>

  <!-- Hidden cutout image (place noshirt.png in the same folder as this HTML) -->
  <img src="noshirt.png" alt="" class="lift-img" id="liftImg" />

  <!-- Celebration Page -->
  <div class="celebrate" id="celebrate">
    <div class="love-wall" aria-hidden="true">
  <div class="love-track">
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
  </div>
  <div class="love-track alt">
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
    <span>I love you Liv! ðŸ’—</span>
  </div>
</div>
    <canvas id="party"></canvas>
    <button class="env-float" id="envFloat" type="button" aria-label="Open letter">
  <img src="envelope.png" alt="" draggable="false" />
</button>

<!-- Letter overlay / notepad -->
<div class="letter-overlay" id="letterOverlay" aria-hidden="true">
  <div class="letter" role="dialog" aria-modal="true" aria-label="Letter">
    <button class="letter-close" id="letterClose" type="button">Close âœ•</button>
    <h3>Hi Liv ðŸ’—</h3>
    <p>
      I'm glad you said yes!.... for your sake. I love you so much and I look forward to the 
     years to come. Hopefully this made your day a little bit better :). Valentines Day 
      can't come soon enough. See you in Palm Springs poops!ðŸŒ´
    </p>
    <p>
       
    </p>
  </div>
</div>
    <div class="celebrate-ui">
      <div class="celebrate-card">
        <h2 class="big">Very Nice! ðŸ’–</h2>
        <p class="small">Glad you made the right choice ðŸ˜Œ</p>
      </div>
    </div>
  </div>

  <script>
  // ------------------- Main page logic (No button) -------------------
  const card = document.getElementById("card");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn  = document.getElementById("noBtn");
  const msg    = document.getElementById("msg");

  const speechEl = document.getElementById("speech");
  const speechText = document.getElementById("speechText");

  // Liv's eyes only
  const secretBtn = document.getElementById("secretBtn");
  const liftImg = document.getElementById("liftImg");
  secretBtn.addEventListener("click", () => {
    liftImg.classList.toggle("show");
  });

  // Shuffle-bag phrases (all 3 appear before repeating)
  const phrasesBase = [
    "Nice try Bingus",
    "You were so close bro",
    "Liv get away from me"
  ];
  let phraseBag = [];
  function refillBag(){
    phraseBag = [...phrasesBase];
    for (let i = phraseBag.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [phraseBag[i], phraseBag[j]] = [phraseBag[j], phraseBag[i]];
    }
  }
  function nextPhrase(){
    if (phraseBag.length === 0) refillBag();
    return phraseBag.pop();
  }

  const repelRadius = 110;
  const push = 12;
  const damping = 0.92;

  const edgePad = 10;
  const cornerZone = 28;
  const trapDist = 50;
  const cooldown = 700;

  const startGap = 16;
  const bubbleOffsetX = 10;
  const bubbleOffsetY = 12;

  let lastTeleport = 0;

  // Fix for â€œmoving on loadâ€: pointer starts offscreen until user moves
  let pointer = { x: -99999, y: -99999 };
  let pointerSeen = false;

  let pos = { x: 0, y: 0 };
  let vel = { x: 0, y: 0 };
  let initialized = false;

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function placeNoBesideYesCentered(){
    const yr = yesBtn.getBoundingClientRect();

    noBtn.style.visibility = "hidden";
    noBtn.style.left = "0px";
    noBtn.style.top  = "0px";
    const nr = noBtn.getBoundingClientRect();

    let x = yr.right + startGap;
    let y = (yr.top + yr.height/2) - (nr.height/2);

    x = clamp(x, edgePad, innerWidth - nr.width - edgePad);
    y = clamp(y, edgePad, innerHeight - nr.height - edgePad);

    pos.x = x; pos.y = y;
    vel.x = 0; vel.y = 0;

    noBtn.style.left = pos.x + "px";
    noBtn.style.top  = pos.y + "px";
    noBtn.style.visibility = "visible";

    initialized = true;
  }

  let bubbleVisibleUntil = 0;
  function showSpeechNow(text){
    speechText.textContent = text;
    bubbleVisibleUntil = Date.now() + 1100;
    speechEl.classList.add("show");
    updateSpeechPosition();
  }

  function updateSpeechPosition(){
    const now = Date.now();
    if (now > bubbleVisibleUntil){
      speechEl.classList.remove("show");
      return;
    }
    const nr = noBtn.getBoundingClientRect();
    const sr = speechEl.getBoundingClientRect();
    const bubbleW = sr.width || 240;
    const bubbleH = sr.height || 44;

    let bx = nr.right + bubbleOffsetX;
    let by = nr.top - bubbleH + bubbleOffsetY;

    bx = clamp(bx, 10, innerWidth - bubbleW - 10);
    by = clamp(by, 10, innerHeight - bubbleH - 10);

    speechEl.style.transform = `translate(${bx}px, ${by}px)`;
  }

  function teleport(){
    const now = Date.now();
    if (now - lastTeleport < cooldown) return;
    lastTeleport = now;

    const nr = noBtn.getBoundingClientRect();
    const w = nr.width, h = nr.height;

    for (let i=0;i<18;i++){
      const x = edgePad + Math.random() * (innerWidth  - w - edgePad*2);
      const y = edgePad + Math.random() * (innerHeight - h - edgePad*2);
      const dist = Math.hypot((x+w/2)-pointer.x, (y+h/2)-pointer.y);

      if (!pointerSeen || dist > 220){
        pos.x = x; pos.y = y;
        vel.x *= .2; vel.y *= .2;

        noBtn.style.left = pos.x + "px";
        noBtn.style.top  = pos.y + "px";

        showSpeechNow(nextPhrase());
        return;
      }
    }

    pos.x = clamp(pos.x, edgePad, innerWidth - w - edgePad);
    pos.y = clamp(pos.y, edgePad, innerHeight - h - edgePad);
    noBtn.style.left = pos.x + "px";
    noBtn.style.top  = pos.y + "px";
    showSpeechNow(nextPhrase());
  }

  function setPointer(x,y){
    pointer.x = x; pointer.y = y;
    pointerSeen = true;
  }
  addEventListener("mousemove", e => setPointer(e.clientX, e.clientY), {passive:true});
  addEventListener("touchmove", e => {
    if (e.touches[0]) setPointer(e.touches[0].clientX, e.touches[0].clientY);
  }, {passive:true});

  // ------------------- Celebration Page -------------------
  const celebrateEl = document.getElementById("celebrate");
  const canvas = document.getElementById("party");
  const ctx = canvas.getContext("2d");

  let celebrating = false;

  function resizeCanvas(){
    canvas.width = Math.floor(window.innerWidth * devicePixelRatio);
    canvas.height = Math.floor(window.innerHeight * devicePixelRatio);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
  }
  window.addEventListener("resize", resizeCanvas);

  // Particle systems
  const confetti = [];
  const hearts = [];
  const sparks = [];

  function rand(min, max){ return Math.random() * (max - min) + min; }
  function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

  function spawnConfettiBurst(x, y, n=80){
    for (let i=0;i<n;i++){
      confetti.push({
        x, y,
        vx: rand(-5, 5),
        vy: rand(-8, -2),
        g: rand(0.15, 0.25),
        r: rand(0, Math.PI*2),
        vr: rand(-0.25, 0.25),
        w: rand(6, 12),
        h: rand(4, 10),
        life: rand(90, 140),
        color: pick(["#ff4d7d","#ff7aa2","#ffd1df","#ffffff","#ffb3c7"])
      });
    }
  }

  function spawnFirework(x, y){
    const count = 70;
    for (let i=0;i<count;i++){
      const a = (Math.PI * 2) * (i / count);
      const sp = rand(2.5, 5.2);
      sparks.push({
        x, y,
        vx: Math.cos(a)*sp + rand(-0.2,0.2),
        vy: Math.sin(a)*sp + rand(-0.2,0.2),
        g: 0.06,
        life: rand(50, 80),
        color: pick(["#ff4d7d","#ff7aa2","#ffd1df","#ffe6ef","#ffffff"])
      });
    }
  }

  function spawnHeart(){
    hearts.push({
      x: rand(0, window.innerWidth),
      y: window.innerHeight + 20,
      vy: rand(-1.4, -0.7),
      vx: rand(-0.35, 0.35),
      s: rand(16, 32),
      life: rand(220, 340),
      text: pick(["ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’ž","â¤"])
    });
  }

  let t = 0;
  function partyLoop(){
    if (!celebrating) return;

    t++;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    if (t % 6 === 0) spawnHeart();

    if (t % 22 === 0){
      const fx = rand(window.innerWidth*0.15, window.innerWidth*0.85);
      const fy = rand(window.innerHeight*0.12, window.innerHeight*0.55);
      spawnFirework(fx, fy);
    }

    if (t % 3 === 0){
      spawnConfettiBurst(rand(window.innerWidth*0.2, window.innerWidth*0.8), -10, 18);
    }

    for (let i=confetti.length-1;i>=0;i--){
      const p = confetti[i];
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.r += p.vr;
      p.life--;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.r);
      ctx.globalAlpha = Math.max(0, Math.min(1, p.life / 100));
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();

      if (p.life <= 0 || p.y > window.innerHeight + 40) confetti.splice(i,1);
    }

    for (let i=hearts.length-1;i>=0;i--){
      const h = hearts[i];
      h.x += h.vx;
      h.y += h.vy;
      h.life--;

      ctx.globalAlpha = Math.max(0, Math.min(1, h.life / 140));
      ctx.font = `${h.s}px system-ui, Apple Color Emoji, Segoe UI Emoji`;
      ctx.fillText(h.text, h.x, h.y);

      if (h.life <= 0 || h.y < -40) hearts.splice(i,1);
    }

    for (let i=sparks.length-1;i>=0;i--){
      const s = sparks[i];
      s.vy += s.g;
      s.x += s.vx;
      s.y += s.vy;
      s.life--;

      ctx.globalAlpha = Math.max(0, Math.min(1, s.life / 60));
      ctx.fillStyle = s.color;
      ctx.beginPath();
      ctx.arc(s.x, s.y, 2, 0, Math.PI*2);
      ctx.fill();

      if (s.life <= 0) sparks.splice(i,1);
    }

    ctx.globalAlpha = 1;
    requestAnimationFrame(partyLoop);
  }

  // ------------------- Envelope + Letter (ONLY after the above exists) -------------------
  const envFloat = document.getElementById("envFloat");
  const letterOverlay = document.getElementById("letterOverlay");
  const letterClose = document.getElementById("letterClose");

  let env = { x: 200, y: 400, tx: 700, ty: 240, vx: 0, vy: 0 };
  let envPaused = false;
  let envWhisked = false;
  envFloat.addEventListener("mouseenter", () => envPaused = true);
envFloat.addEventListener("mouseleave", () => envPaused = false);



  function pickNewTarget(){
    const pad = 90;
    env.tx = pad + Math.random() * (window.innerWidth  - pad*2);
    env.ty = pad + Math.random() * (window.innerHeight - pad*2);
  }

  let targetTimer = null;

  function floatLoop(){
    if (!celebrating) return;
    if (envPaused || envWhisked) {
  requestAnimationFrame(floatLoop);
  return;
}

    const ax = (env.tx - env.x) * 0.00018;
    const ay = (env.ty - env.y) * 0.00018;

    env.vx = (env.vx + ax) * 0.94;
    env.vy = (env.vy + ay) * 0.94;

    env.x += env.vx * 10;
    env.y += env.vy * 10;

    env.x = clamp(env.x, 70, window.innerWidth - 70);
    env.y = clamp(env.y, 70, window.innerHeight - 70);

    envFloat.style.left = env.x + "px";
    envFloat.style.top  = env.y + "px";

    requestAnimationFrame(floatLoop);
  }

  function startEnvelopeWander(){
    envFloat.style.display = "block";
    envFloat.classList.remove("open");

    env.x = window.innerWidth * 0.2;
    env.y = window.innerHeight * 0.65;
    env.vx = env.vy = 0;
   


// (mobile) pause while finger is down
envFloat.addEventListener("touchstart", () => envPaused = true, {passive:true});
envFloat.addEventListener("touchend", () => envPaused = false, {passive:true});


    pickNewTarget();
    clearInterval(targetTimer);
    targetTimer = setInterval(pickNewTarget, 5000);

    floatLoop();
  }

  function openLetter(){
  if (envWhisked) return;

  // stop moving so click feels stable
  envPaused = true;

  // play open animation + paper slides out
  envFloat.classList.add("open");

  // show letter after the slide-out starts
  setTimeout(() => {
    letterOverlay.classList.add("show");
    letterOverlay.setAttribute("aria-hidden", "false");
  }, 320);

  // then whisp away
  setTimeout(() => {
    envWhisked = true;
    envFloat.classList.add("whisp");
    clearInterval(targetTimer);
    // remove from layout after fade
    setTimeout(() => {
      envFloat.style.display = "none";
    }, 520);
  }, 520);
}


  function closeLetter(){
    letterOverlay.classList.remove("show");
    letterOverlay.setAttribute("aria-hidden", "true");
    envFloat.classList.remove("open");
  }

  envFloat.addEventListener("click", openLetter);
  letterClose.addEventListener("click", closeLetter);
  letterOverlay.addEventListener("click", (e) => {
    if (e.target === letterOverlay) closeLetter();
  });

  // ------------------- Start celebration -------------------
  function startCelebration(){
    celebrating = true;

    card.style.display = "none";
    noBtn.style.display = "none";
    speechEl.style.display = "none";

    secretBtn.style.display = "none";
    liftImg.style.display = "none";

    celebrateEl.classList.add("show");
    resizeCanvas();

    // start envelope drifting
    startEnvelopeWander();

    spawnConfettiBurst(window.innerWidth/2, window.innerHeight*0.25, 160);
    spawnFirework(window.innerWidth*0.35, window.innerHeight*0.30);
    spawnFirework(window.innerWidth*0.65, window.innerHeight*0.28);

    t = 0;
    partyLoop();
  }

  // âœ… Yes click still works
  yesBtn.addEventListener("click", () => {
    msg.textContent = "Nice to see you made the right choice ðŸ’˜";
    startCelebration();
  });

  // ------------------- No button loop -------------------
  function tick(){
    if (!initialized || celebrating){
      requestAnimationFrame(tick);
      return;
    }

    const nr = noBtn.getBoundingClientRect();
    const cx = nr.left + nr.width/2;
    const cy = nr.top  + nr.height/2;

    if (pointerSeen){
      const dx = cx - pointer.x;
      const dy = cy - pointer.y;
      const dist = Math.hypot(dx,dy);

      if (dist < repelRadius){
        const nx = dx/(dist||1);
        const ny = dy/(dist||1);
        const f = (repelRadius - dist) / repelRadius;
        vel.x += nx * f * push;
        vel.y += ny * f * push;
      }

      const nearLeft = nr.left <= cornerZone;
      const nearRight = (innerWidth - nr.right) <= cornerZone;
      const nearTop = nr.top <= cornerZone;
      const nearBottom = (innerHeight - nr.bottom) <= cornerZone;
      const inCorner = (nearLeft || nearRight) && (nearTop || nearBottom);

      if (inCorner && dist < trapDist) teleport();
    } else {
      vel.x = 0; vel.y = 0;
    }

    vel.x *= damping; vel.y *= damping;
    pos.x += vel.x; pos.y += vel.y;

    const maxX = innerWidth  - nr.width  - edgePad;
    const maxY = innerHeight - nr.height - edgePad;
    pos.x = clamp(pos.x, edgePad, maxX);
    pos.y = clamp(pos.y, edgePad, maxY);

    noBtn.style.left = pos.x + "px";
    noBtn.style.top  = pos.y + "px";

    updateSpeechPosition();
    requestAnimationFrame(tick);
  }

  // ------------------- Init -------------------
  async function init(){
    refillBag();
    try { if (document.fonts?.ready) await document.fonts.ready; } catch {}
    placeNoBesideYesCentered();
    requestAnimationFrame(tick);
  }
  window.addEventListener("load", init);
</script>

</body>
</html>
